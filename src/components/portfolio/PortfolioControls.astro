---
import type { Project } from '../../types/portfolio';

interface Props {
  projects: Project[];
}

const { projects } = Astro.props;

// Extract unique themes, stages, and years
const uniqueThemes = [...new Set(projects.map(p => p.theme))].sort();
const uniqueStages = [...new Set(projects.map(p => p.growthStage))].sort();
const uniqueYears = [...new Set(projects.map(p => p.year))].sort((a, b) => b - a);
---

<div class="portfolio-controls">
  <div class="container">
    <div class="controls-content">
      <input
        type="search"
        id="search-input"
        class="search-input"
        placeholder="Search projects, technologies, or keywords..."
        aria-label="Search projects"
      />

      <div class="filter-group">
        <label class="filter-label" for="theme-filter">Theme</label>
        <select id="theme-filter" class="filter-select" aria-label="Filter by theme">
          <option value="all">All Themes</option>
          {uniqueThemes.map(theme => (
            <option value={theme}>{theme}</option>
          ))}
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label" for="stage-filter">Stage</label>
        <select id="stage-filter" class="filter-select" aria-label="Filter by growth stage">
          <option value="all">All Stages</option>
          {uniqueStages.map(stage => (
            <option value={stage}>{stage}</option>
          ))}
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label" for="year-filter">Year</label>
        <select id="year-filter" class="filter-select" aria-label="Filter by year">
          <option value="all">All Years</option>
          {uniqueYears.map(year => (
            <option value={year.toString()}>{year}</option>
          ))}
        </select>
      </div>
    </div>
  </div>
</div>

<style>
  .portfolio-controls {
    background: #eeeeee;
    border-bottom: 2px solid rgba(26, 26, 26, 0.1);
    padding: 1.25rem 0;
    position: sticky;
    top: 160px;
    z-index: 98;
  }

  .controls-content {
    display: flex;
    gap: 1rem;
    align-items: center;
    flex-wrap: wrap;
  }

  .search-input {
    flex: 1;
    min-width: 300px;
    padding: 0.75rem 1rem;
    background: #f5f5f5;
    border: 2px solid rgba(26, 26, 26, 0.1);
    color: rgba(26, 26, 26, 0.85);
    font-size: 0.875rem;
    font-family: 'Helvetica Neue', Arial, sans-serif;
    transition: border-color 0.2s;
  }

  .search-input:focus {
    outline: none;
    border-color: #05cd99;
    box-shadow: 0 0 0 3px rgba(5, 205, 153, 0.1);
    transition: border-color 0.2s, box-shadow 0.2s;
  }

  .search-input::placeholder {
    color: rgba(26, 26, 26, 0.5);
  }

  .filter-group {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .filter-label {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: rgba(26, 26, 26, 0.65);
  }

  .filter-select {
    padding: 0.75rem 1rem;
    background: #f5f5f5;
    border: 2px solid rgba(26, 26, 26, 0.1);
    color: rgba(26, 26, 26, 0.85);
    font-size: 0.875rem;
    font-family: 'Helvetica Neue', Arial, sans-serif;
    cursor: pointer;
    transition: border-color 0.2s;
  }

  .filter-select:focus {
    outline: none;
    border-color: #05cd99;
    box-shadow: 0 0 0 3px rgba(5, 205, 153, 0.1);
    transition: border-color 0.2s, box-shadow 0.2s;
  }

  :global(body.dark-theme) .portfolio-controls {
    background: #141414;
    border-bottom-color: rgba(5, 205, 153, 0.2);
  }

  :global(body.dark-theme) .search-input,
  :global(body.dark-theme) .filter-select {
    background: #1a1a1a;
    border-color: #2a2a2a;
    color: rgba(245, 245, 245, 0.85);
  }

  :global(body.dark-theme) .search-input:focus,
  :global(body.dark-theme) .filter-select:focus {
    border-color: #05cd99;
    box-shadow: 0 0 0 3px rgba(5, 205, 153, 0.12);
  }

  :global(body.dark-theme) .search-input::placeholder {
    color: rgba(200, 200, 200, 0.5);
  }

  :global(body.dark-theme) .filter-label {
    color: rgba(200, 200, 200, 0.65);
  }

  @media (max-width: 768px) {
    .portfolio-controls {
      padding: 1rem 0;
      top: 140px;
    }

    .controls-content {
      flex-direction: column;
      align-items: stretch;
      gap: 0.75rem;
    }

    .search-input {
      min-width: 100%;
      padding: 0.65rem 0.875rem;
      font-size: 0.8125rem;
    }

    .filter-group {
      width: 100%;
      gap: 0.75rem;
    }

    .filter-label {
      font-size: 0.65rem;
      min-width: 70px;
    }

    .filter-select {
      flex: 1;
      padding: 0.65rem 0.875rem;
      font-size: 0.8125rem;
    }
  }

  @media (max-width: 480px) {
    .portfolio-controls {
      padding: 0.75rem 0;
      top: 140px;
    }

    .controls-content {
      gap: 0.5rem;
      padding: 0 0.75rem;
    }

    .search-input {
      padding: 0.6rem 0.75rem;
      font-size: 0.75rem;
    }

    .filter-group {
      gap: 0.5rem;
    }

    .filter-label {
      font-size: 0.6rem;
      min-width: 60px;
    }

    .filter-select {
      padding: 0.6rem 0.75rem;
      font-size: 0.75rem;
    }
  }
</style>
