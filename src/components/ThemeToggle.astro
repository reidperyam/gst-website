---
// ThemeToggle.astro - Theme switcher component
import { trackThemeToggle } from '../utils/analytics';
---

<button class="theme-toggle" id="themeToggle" data-testid="theme-toggle" title="Toggle dark theme" aria-label="Toggle dark theme">
    <img
        src="/images/logo/gst-delta-icon-teal-stroke-thick.svg"
        alt=""
        class="theme-toggle-icon"
        aria-hidden="true"
    />
</button>

<style>
    .theme-toggle-icon {
        width: 0.67em;
        height: 0.67em;
        display: block;
    }
</style>

<script>
    import { trackThemeToggle } from '../utils/analytics';

    const themeToggle = document.getElementById('themeToggle');
    const htmlElement = document.documentElement;

    // Check for saved theme preference or default to light
    let currentTheme = 'light';
    try {
        currentTheme = localStorage.getItem('theme') || 'light';
    } catch (e) {
        console.error('Failed to access localStorage:', e);
        currentTheme = 'light';
    }

    if (currentTheme === 'dark') {
        document.body.classList.add('dark-theme');
    }

    if (themeToggle) {
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-theme');
            const isDark = document.body.classList.contains('dark-theme');

            try {
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
            } catch (e) {
                console.error('Failed to save theme preference:', e);
            }

            // Track theme toggle in analytics
            trackThemeToggle(isDark ? 'dark' : 'light');
        });
    }
</script>
