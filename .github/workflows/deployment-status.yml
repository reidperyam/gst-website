name: Deployment Status

on:
  deployment_status:

jobs:
  update-pr-status:
    if: github.event.deployment_status.state == 'success'
    runs-on: ubuntu-latest

    steps:
      - name: Comment on PR
        uses: actions/github-script@v7
        with:
          script: |
            const deploymentUrl = '${{ github.event.deployment_status.environment_url }}';
            const environment = '${{ github.event.deployment.environment }}';

            // Only comment on PRs
            if (!context.issue.number) {
              return;
            }

            let message = `ðŸš€ **Preview Deployed**\n\n`;
            message += `[View Preview](${deploymentUrl})\n\n`;
            message += `Environment: \`${environment}\`\n`;
            message += `Ready for review before merging to main!`;

            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: message
            });
